<div *ngIf="!isLoaded" class="flex justify-center items-center h-64">
  <div class="text-[#771020] text-2xl font-bold animate-pulse">Chargement...</div>
</div>

<div *ngIf="isLoaded">
  <section class="bg-[#ede6ce] px-6 py-16">
  <div class="mx-auto mb-12 max-w-3xl text-center">
    <h1 class="mb-4 text-4xl font-bold text-[#771020]">Liste des voitures de l'agence</h1>
    <p class="text-lg text-[#771020]">Voici les voitures disponibles dans cette agence.</p>
  </div>

  <div class="mb-6 max-w-2xl mx-auto bg-white p-4 rounded-lg shadow-md">
    <div class="flex flex-wrap justify-center gap-5">
      <input
        type="text"
        class="rounded border border-[#771020] px-3 py-2 text-[#771020] focus:outline-none focus:ring-2 focus:ring-[#f1b939] cursor-pointer"
        placeholder="üî† Rechercher par cat√©gorie"
        [(ngModel)]="filters.categorie"
        (ngModelChange)="agenceId !== null ? loadVoitures(agenceId) : null" />

      <select
        class="rounded border border-[#771020] px-3 py-2 text-[#771020] focus:outline-none focus:ring-2 focus:ring-[#f1b939] cursor-pointer"
        [(ngModel)]="filters.etat"
        (ngModelChange)="agenceId !== null ? loadVoitures(agenceId) : null">
        <option value="">S√©lectionner un √©tat</option>
        <option *ngFor="let etat of etats" [value]="etat">{{ etat }}</option>
      </select>

      <button
        (click)="resetFilters()"
        class="rounded border-2 border-[#771020] bg-[#f1b939] px-3 py-2 font-semibold text-[#771020] transition hover:bg-[#fff0c2] cursor-pointer">
        R√©initialiser les filtres
      </button>
    </div>
  </div>


  <div class="overflow-x-auto rounded-2xl bg-white shadow-lg border border-[#771020] max-w-7xl mx-auto">
    <table class="min-w-full table-fixed text-base">
      <thead class="bg-[#f1b939] text-[#771020] text-base font-semibold">
      <tr>
        <th class="w-[10%] px-4 py-4 text-center uppercase tracking-wide cursor-pointer" (click)="sortBy('marque')">
          <div class="flex items-center justify-center gap-1">
            Marque <i class='bx bx-filter-alt'></i>
          </div>
        </th>
        <th class="w-[10%] px-4 py-4 text-center uppercase tracking-wide cursor-pointer" (click)="sortBy('modele')">
          <div class="flex items-center justify-center gap-1">
            Mod√®le <i class='bx bx-filter-alt'></i>
          </div>
        </th>
        <th class="w-[10%] px-4 py-4 text-center uppercase tracking-wide cursor-pointer" (click)="sortBy('kilometrage')">
          <div class="flex items-center justify-center gap-1">
            Kilom√©trage <i class='bx bx-filter-alt'></i>
          </div>
        </th>
        <th class="w-[15%] px-4 py-4 text-center uppercase tracking-wide ">
          <div class="flex items-center justify-center gap-1">
            Immatriculation
          </div>
        </th>
        <th class="w-[10%] px-4 py-4 text-center uppercase tracking-wide cursor-pointer" (click)="sortBy('categorie')">
          <div class="flex items-center justify-center gap-1">
            Cat√©gorie <i class='bx bx-filter-alt'></i>
          </div>
        </th>
        <th class="w-[10%] px-4 py-4 text-center uppercase tracking-wide">
          <div class="flex items-center justify-center gap-1">
            √âtat
          </div>
        </th>
        <th class="w-[10%] px-4 py-4 text-center uppercase tracking-wide">D√©tails</th>
        <th class="w-[15%] px-4 py-4 text-center uppercase tracking-wide">Modification</th>
      </tr>
      </thead>
      <tbody class="divide-y divide-[#ede6ce] text-[#771020] bg-white text-base">
        @for (voiture of voitures(); track voiture.id) {
          <tr class="hover:bg-[#fff0c2] transition-colors duration-200">
            <td class="w-[10%] px-4 py-4 h-16 text-center">{{ voiture.marque }}</td>
            <td class="w-[10%] px-4 py-4 h-16 text-center">{{ voiture.modele }}</td>
            <td class="w-[10%] px-4 py-4 h-16 text-center">{{ voiture.kilometrage }}</td>
            <td class="w-[15%] px-4 py-4 h-16 text-center">{{ voiture.immatriculation }}</td>
            <td class="w-[10%] px-4 py-4 h-16 text-center">{{ voiture.categorie.type_categorie }}</td>
            <td class="w-[10%] px-4 py-4 h-16 text-center">{{ voiture.etat }}</td>
            <td class="w-[10%] px-4 py-4 h-16 text-center">
              <a [routerLink]="['/detail-voiture', voiture.id]" class="cursor-pointer">
                <i class='bx bx-search text-3xl text-[#771020] hover:text-[#f1b939] transition-colors duration-100'></i>
              </a>
            </td>
            <td class="w-[15%] px-4 py-4 h-16 text-center">
              <a [routerLink]="['/update-voiture', voiture.id]" class="cursor-pointer">
                <i class='bx bx-edit-alt text-3xl text-[#771020] hover:text-[#f1b939] transition-colors duration-100'></i>
              </a>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</section>
</div>
